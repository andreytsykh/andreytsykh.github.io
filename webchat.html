<html>
  <body>
<script type='text/javascript'>
	window.addEventListener("onEmbeddedMessagingReady", () => {
  			console.log("Received the onEmbeddedMessagingReady event.");
		embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels = [
			{labelName:'_firstName', labelValue: localStorage.getItem('firstName')},
			{labelName:'_lastName', labelValue: localStorage.getItem('lastName')},
			{labelName:'_email', labelValue: localStorage.getItem('email')},
			{labelName:'Company', labelValue: localStorage.getItem('company')},
			{labelName:'Phone', labelValue: localStorage.getItem('phone')},
			{labelName:'CompanyId', labelValue: localStorage.getItem('companyId')},
			{labelName:'UserId', labelValue: localStorage.getItem('userId')},
		];

		embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
			CompanyId: localStorage.getItem('CompanyId'),
			UserId: localStorage.getItem('UserId')
		});

		embeddedservice_bootstrap.userVerificationAPI.setIdentityToken
	            ({
	            identityTokenType : "JWT", 
	            //identityToken :"{The JWT token key value that we created in Stage 4}"
	            identityToken :"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjEyMzQ1NiJ9.eyJzdWIiOiJuZXdjdXN0b21lckBnbWFpbC5jb20iLCJpc3MiOiJTaGlwNHdkIiwiZXhwIjoxNzcwMjkyNjkwfQ.UePoRwzGgwnh88CBN7Tdn26Cp4gcN9p7FPPGUDQcHaRlU0kRHeX_qWNuUVUBukEyCCTp2yLzqRpMytKiBe-gr5788lxQfL-JknCvC8gi3ShWaXn4h2y2c3XQk89sFGYksA1P5NGsk3m3ojZg5gPRJCJxZABwNHKx_--i48gmt3S97BX_uOkbAEqzK1RpPowt0feSIAUCNeBgvejPAvGxAmS65Ey_WA0ab6_fJSrnZ0VGSwIdY-HeA2X50DYC8NRtfDwpHkzjiAZB7hGHAZKb-a9xLYHrDOfV-l5I-hD9gnC5NVzB02khbQbfPWiU_Z1QPSRzPDWIeKpYBCLthdbWcw"
	            });
  //Add more code here.
	});
	function initEmbeddedMessaging() {
		try {
			console.log('script onload');
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'
			embeddedservice_bootstrap.settings.devMode = true;
			embeddedservice_bootstrap.init(
				'00D7E000000Akyl',
				'Messaging_In_Web_Chat',
				'https://ship4wd--atsykh.sandbox.my.site.com/ESWMessagingInWebChat1705853257395',
				{
					scrt2URL: 'https://ship4wd--atsykh.sandbox.my.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};

	function onUserLogout() {
		  embeddedservice_bootstrap.userVerificationAPI
		    .clearSession()
		    .then(() => {
			    console.log('logout');
		      // Add actions to run after the session is cleared successfully.
		    })
		    .catch((error) => {
		      // Add actions to run after clearing the session fails.
		    })
		    .finally(() => {
		      // Add actions to run whether the chat client launches
		      // successfully or not.
		    });

  // Add code to perform any other logout actions.
	}
</script>
<script type='text/javascript' src='https://ship4wd--atsykh.sandbox.my.site.com/ESWMessagingInWebChat1705853257395/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
	  <button onclick='onUserLogout()'>LOGOUT</button>
  </body>
</html>
